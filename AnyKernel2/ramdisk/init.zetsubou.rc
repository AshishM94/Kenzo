# Zetsubou init script
# Thanks to franciscofranco, ak, nathanchancellor and frap129

on init
   # zram
   write /sys/block/zram0/max_comp_streams 6
   write /sys/block/zram0/disksize 268435456
   
on post-fs
   write /dev/cpuset/foreground/cpus 0-5
   write /dev/cpuset/foreground/boost/cpus 0-5
   write /dev/cpuset/background/cpus 0-5
   write /dev/cpuset/system-background/cpus 0-5

on boot
   # enable sweep2wake up
   chown root root /sys/android_touch/sweep2wake
   chmod 666 /sys/android_touch/sweep2wake
   write /sys/android_touch/sweep2wake 4
   chmod 644 /sys/android_touch/sweep2wake

on property:sys.boot_completed=1
   # cpuset
   write /dev/cpuset/foreground/cpus 0-2,4-5
   write /dev/cpuset/foreground/boost/cpus 4-5
   write /dev/cpuset/background/cpus 0-2
   write /dev/cpuset/system-background/cpus 0-2

   # set I/O scheduler
   write /sys/block/mmcblk0/queue/rq_affinity 0
   write /sys/block/mmcblk0/bdi/min_ratio 5
   write /sys/block/mmcblk0/queue/read_ahead_kb 256

   # set min/max frequencies for both clusters
   # a53 min 400MHz
   chown system system /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq
   chmod 0664 /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq
   write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 400000
   # a53 max 1401MHz
   chown system system /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
   chmod 0664 /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
   write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 1401600
   # a72 min 400MHz
   chown system system /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq
   chmod 0664 /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq
   write /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq 400000
   # a72 max 1804MHz
   chown system system /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq
   chmod 0664 /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq
   write /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq 1804800

   # adreno-boost
   write /sys/class/kgsl/kgsl-3d0/devfreq/adrenoboost 1

   # enable laptop mode
   write /proc/sys/vm/laptop_mode 1

   # disable core control and enable msm thermal
   write /sys/module/msm_thermal/core_control/enabled 0
   write /sys/module/msm_thermal/parameters/enabled Y
